# Подготовительная программа по программированию на С/С++

## Домашнее задание №4
Необходимо реализовать программу-парсилку писем.

Первым аргументом программе подается путь к файлу письма (.eml).

Что соответствует содержимому письма [8bitmime.eml](btests/emails/8bitmime.eml):
```
0  |Subject: 2 RCPT MIME
1  |From: bob <bob@example.com>
2  |To: xxx@example.net, yyy@example.net
3  |Content-Type: multipart/alternative; boundary="=-omjqkVTVbwdgCWFRgIkx"
4  |Date: Wed, 02 Jun 2010 11:06:27 +0800
5  |Message-ID: <1275447987.2063.842.camel@pony>
6  |Mime-Version: 1.0
7  |X-Mailer: Evolution 2.28.3
8  |Received: from is-atl03.i.smailru.net (is-atl03.i.smailru.net [5.61.236.37])
9  |  by is-atl02.i.mail.ru (Postfix) with ESMTP id 964D810071
10 |  for <xxx@example.com>; Mon, 12 Mar 2018 19:18:21 +0300 (MSK)
11 |
12 |
13 |--=-omjqkVTVbwdgCWFRgIkx
14 |Content-Type: text/plain; charset="UTF-8"
15 |Content-Transfer-Encoding: 8bit
16 |
17 |Превел
18 |
19 |123
20 |
21 |--=-omjqkVTVbwdgCWFRgIkx
22 |Content-Type: text/html; charset="utf-8"
23 |Content-Transfer-Encoding: 7bit
24 |
25 |<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 TRANSITIONAL//EN">
26 |<HTML>
27 |<HEAD>
28 |  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=UTF-8">
29 |  <META NAME="GENERATOR" CONTENT="GtkHTML/3.28.3">
30 |</HEAD>
31 |<BODY>
32 |<B>&#1055;&#1088;&#1077;&#1074;&#1077;&#1083;</B><BR>
33 |<BR>
34 |123
35 |</BODY>
36 |</HTML>
37 |
38 |--=-omjqkVTVbwdgCWFRgIkx--
```

Письмо состоит из двух составных частей: заголовков (строки 0 -- 10) и тела (строки 12 -- 38).
Тело письма всегда отделяется пустой строкой (строка 11). Пустых строк может быть несколько.

Допускается отсутствие тела письма. Тогда следом за заголовками будут идти только пустые строки (как минимум 1).

Тело письма может иметь один формат представления (например, только текст или только html-страничка) или несколько (например,
письмо содержит основной текст и дополнительную картинку). Во втором случае письмо помечается
заголовком [multipart](https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html) и говорят, что "письмо состоит из нескольких
партов".

На выход (в STDOUT) программа пишет выделенную из письма информацию, а именно:

```bash
<От кого письмо>|<Кому письмо>|<Время получения письма>|<Количество партов письма>
```

**При выводе информации не должно быть дополнительных пробелов вокруг вертикальных черт.**

+ **От кого письмо**: в это поле должно быть выведено значение заголовка **From** (строка 1)
+ **Кому письмо**: в это поле должно быть выведено значение заголовка **To** (строка 2)
+ **Время получения письма**: в это поле должно быть выведено значение заголовка **Date** (строка 4)
+ **Количество партов письма**: необходимо посмотреть на заголовок **Content-Type** (строка 3).
  - Если письмо содержит несколько партов, заголовок имеет значение `multipart` (строка 3). В этом случае
    нужно найти значение `boundary` (все та же строка 3), в примере это `boundary="=-omjqkVTVbwdgCWFRgIkx"`
    и получить разделитель (в примере это `=-omjqkVTVbwdgCWFRgIkx`, _кавычки могут отсутствовать_). Далее, используя этот
    заголовок, необходимо найти число партов в письме. В примере, первый парт начинается на строке 13, и заканчивается
    на строке 20, второй парт начинается на строке 22 и заканчивается на строке 37. Обратите внимание, парты так же
    имеют заголовки (строки 14, 15, 22, 23). В данном задании они игнорируются.
  - Если заголовка `Content-Type` или `multipart` не найдено, считать, что письмо состоит из одного парта.
  - Если письмо не имеет тела, считать, что число партов равно нулю.

Формат представления заголовка:
```
<Header-Name>: <Header Value>
  <More header value>
```

Двоеточие является разделителем между именем и значением заголовка. Пробел после двоеточия не обязателен.
**Заголовок может быть многострочным** (например, заголовок **Received**, строки 8 -- 10). В этом случае, каждая новая
строка со значением заголовка начинается хотя бы с одного пробела (обычно с двух).
Более того, имя заголовка не обязательно может быть в произвольном
регистре (то есть заголовок **Received** эквивалентен заголовку **RECEIVED** или **received**).
При выводе заголовка в STDOUT необходимо заменить символы переноса строки и пробелы перед значением заголовка на новой строке на один пробел.

Пример:

Исходный заголовок
```
Received: from is-atl03.i.smailru.net (is-atl03.i.smailru.net [5.61.236.37])
  by is-atl02.i.mail.ru (Postfix) with ESMTP id 964D810071
  for <xxx@example.com>; Mon, 12 Mar 2018 19:18:21 +0300 (MSK)
```

Что должно попасть на консоль:
```
|from is-atl03.i.smailru.net (is-atl03.i.smailru.net [5.61.236.37]) by is-atl02.i.mail.ru (Postfix) with ESMTP id 964D810071 for <xxx@example.com>; Mon, 12 Mar 2018 19:18:21 +0300 (MSK)|
```
(вертикальные черты добавлены для визуализации количества пробелов вокруг значения заголовка)

**Считать символом переноса строки в том числе символ `\r` (специфика Windows-систем). Доплустима последовательность `\r\n` и
наоборот.**

Пример:

```bash
$ ./main.out btests/emails/8bitmime.eml
bob <bob@example.com>|xxx@example.net, yyy@example.net|Wed, 02 Jun 2010 11:06:27 +0800|2
```

Примеры писем в папке [btests/emails](btests/emails).

## Не забываем
Запустить линтеры:

```bash
$ make check
```

Запустить тесты:

```bash
$ make test
$ make memtest
```

## Критерии к оцениванию

Максимально можно получить до 2 баллов. 1 балл, если:
- программа работает корректно, запускаются и проходят все автоматические проверки и тесты на CI
- нет копипасты, всё вынесено в отдельные функции
- нет хардкода, имена/логика функций не завязаны на конкретные формулировки из текста задания, все зависимости передаются в качестве параметров
- выполняется принцип единственной ответственности как на уровне функций, так и на уровне файлов
- используется единый и понятный стиль кодирования во всём проекте

+1 балл, если реализация основана на использовании грамматик
